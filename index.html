<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="//d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="liquidFillGauge.js" language="JavaScript"></script>
    <style>

        .axis2 path,
        .axis2 line {
          fill: none;
          stroke: #000;
          shape-rendering: crispEdges;
        }
        
        .dot2 {
          stroke: #000;
        }
        
        .tooltip2 {
          position: absolute;
          width: 200px;
          height: 28px;
          pointer-events: none;
        }

        .bar--positive {
            fill: #DA70D6;
        }

        .bar--negative {
            fill: #1E90FF;
        }

        div.google-visualization-tooltip {
            font-size:  15px !important;
            padding:3px;


        }

        .text_color {
            fill:red;
        }
        div.tooltip {
            position: absolute;
            text-align: center;
            width: 60px;
            height: 28px;
            padding: 2px;
            font: 12px sans-serif;
            background: lightsteelblue;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
        }
        g.controltick {
            fill: none;
            stroke: #666;
            stroke-width: 2px;
        }
        g.yclass {
            fill: none;
            stroke: #666;
            stroke-width: 2px;
        }
        .domain text {
            font: 10px sans-serif;
        }

        .selecting rect {
            fill-opacity: .2;
        }

        .selecting rect.selected {
            fill-opacity:1;
        }
        .controltick .tick{ display: none; }

        .controltick path.domain line{
            stroke-width:0.1px;
        }


        .brush .extent {
            stroke: #fff;
            fill-opacity:.123;
            shape-rendering: crispEdges;
        }
.MyCircle {
    fill: #FCAD62;
}

.line {
    fill: none;
    stroke: #FCAD62;
    stroke-width: 1.5px;
}
path.line {
  fill: none;
  stroke: #666;
  stroke-width: 1.5px;
}

path.area {
  fill: #e7e7e7;
}

.axis {
  shape-rendering: crispEdges;
}

.x.axis line {
  stroke: #fff;
}
.x.axis path {
  fill: none;
  stroke: #000;
}
.x.axis .minor {
  stroke-opacity: .5;
}

.inner_line line {
    fill: none;
    stroke:#E7E7E7;
    shape-rendering: crispEdges;
}
.y.axis line,
.y.axis path {
  fill: none;
  stroke: #000;
}

        .month {
            fill: none;
            stroke: #000;
            stroke-width: 2px;
        }
        .day {
            fill: #fff;
            stroke: #ccc;
        }
        /*text    {*/
            /*font-family:sans-serif;*/
            /*font-size:1.5em;*/
        /*}*/
        .dayLabel   {
            fill:#aaa;
            font-size:0.8em;
        }
        .monthLabel {
            text-anchor:middle;
            font-size:0.8em;
            fill:#aaa;
        }
        .yearLabel  {
            fill:#aaa;
            font-size:1.2em;
        }

        .key    {font-size:0.5em;}
        .selected {
            fill:"blue";
        }
        .liquidFillGaugeText { 
            font-family: Helvetica; 
            font-weight: bold; 
        }

    </style>
</head>
<body>
<script>


    function compare(teams){
        team1 = teams[0]
        team2 = teams[1]
        var parseDate = d3.time.format("%m/%d/%Y").parse;
        d3.csv('data.csv',function(d){
            d.MIN = +d.MIN;
            d.DREB = +d.DREB;
            d.TOV = +d.TOV;
            d.REB = +d.REB;
            d.STL = +d.STL;
            d.BLK = +d.BLK;
            d.AST = +d.AST;
            d.PTS = +d.PTS;
            d.FGM = +d.FGM;
            d.FGA = +d.FGA;
            d.FG_PCT= +d.FG_PCT;
            d.FG3M = +d.FG3M;
            d.FG3A = +d.FG3A;
            d.FG3_PCT = +d.FG3_PCT;
            d.FT_PCT = +d.FT_PCT;
            d.OREB = +d.OREB;
            d.PF = +d.PF;
            d.FTA = +d.FTA;
            d.FTM = +d.FTM;
            d.GAME_DATE = d.GAME_DATE.substring(0,d.GAME_DATE.length-2)+"20"+d.GAME_DATE.substring(d.GAME_DATE.length-2,d.GAME_DATE.length);
            d.GAME_DATE = parseDate(d.GAME_DATE);
            return d;
        }, function (error, data) {
            if (error) throw error;
            var tmpdata = filter(data, team1, team2)
            var tmpdata1 = tmpdata[0];
            var tmpdata2 = tmpdata[1];
            var tmpdata = [];
            for (var i = 0; i < tmpdata1.length; i++){
                var tmparray = [];
                tmpdata.push(tmpdata1[i]);
                tmpdata.push(tmpdata2[i]);
            }
            //console.log(tmpdata);
            var margin = {top: 20, right: 20, bottom: 30, left: 50};
            var width = 1100 - margin.left - margin.right;
            var height = 200 - margin.top - margin.bottom;
            var svg = d3.select("#compare")
            var g = svg.select('g');
            if (!svg.empty()) {
                svg.select('svg').remove()

            }
            var svg = d3.select("#compare")
                    .append("svg")
                    .attr("width",1200)
                    .attr("height",250)
                    .append("g")
                    .attr("transform","translate(100,50)")

            var x = d3.time.scale()
                    .range([0, width]);
            var y = d3.scale.linear()
                    .range([height,0]);
            var xAxis = d3.svg.axis()
                    .scale(x)
                    .orient("bottom")
                    .tickFormat(d3.time.format("%Y.%m.%d"))

            var yAxis = d3.svg.axis()
                    .scale(y)
                    .orient("left");
            x.domain(d3.extent(tmpdata, function(d) { return d.GAME_DATE; }));
            y.domain([d3.min(tmpdata,function(d){return d.PTS;})-5,d3.max(tmpdata,function(d){return d.PTS;})+5]);


            svg.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(xAxis)
                    .selectAll("text")
                    .style("font-size","10px")
                    .attr("transform", "rotate(20)")
                    .attr("y",15);
            svg.append("g")
                    .attr("class", "y axis")
                    .call(yAxis)
                    .attr("transform", "translate(0,0)")
                    .selectAll("text")
                    .style("font-size","10px");
            var yInner = d3.svg.axis()
                    .scale(y)
                    .tickSize(-width,0,0)
                    .tickFormat("")
                    .orient("left")
                    .ticks(5);
            var yInnerBar=svg.append("g")
                    .attr("class", "inner_line")
                    .attr("transform", "translate(0,-25)")
                    .call(yInner);

            svg.append("g")
                    .append("circle")
                    .attr("transform","translate(0,0)")
                    .attr("r", 6)
                    .attr("opacity", 0)
                    .transition()
                    .duration(1500)
                    .attr("cx", function(){ return 950; })
                    .attr("opacity", 0.8)
                    .attr("cy", function(){ return 5;})
                    .attr("fill","#DA70D6");   
            svg.append("g")
                    .append("text")
                    .attr("transform","translate(0,0)")
                    .attr("x",962)
                    .attr("y",7)
                    .text(tmpdata1[0].TEAM_ABBREVIATION)
                    .style("font-size","14px")
                    .transition()
                    .duration(1500)                    
                    .fill("black")



            svg.append("g")
                    .append("circle")
                    .attr("transform","translate(0,0)")
                    .attr("r", 6)
                    .attr("opacity", 0)
                    .transition()
                    .duration(1500)
                    .attr("cx", function(){ return 950; })
                    .attr("opacity", 0.8)
                    .attr("cy", function(){ return 20;})
                    .attr("fill","#1E90FF");   

            svg.append("g")
                    .append("text")
                    .attr("transform","translate(0,0)")
                    .attr("x",962)
                    .attr("y",22)
                    .text(tmpdata2[0].TEAM_ABBREVIATION)
                    .style("font-size","14px")
                    .transition()
                    .duration(1500)                    
                    .fill("black")                    

            for(var i=0; i < tmpdata1.length; i++){
                // console.log(team1_detail)
                svg.append("g")
                        .append("circle")
                        .on("mouseover",function(){
                            var cur_id = d3.select(this).attr("id");
                            var idx = cur_id.split("_")[1]
//                            console.log(idx);
                            var team1_detail = tmpdata1[idx];
                            var team2_detail = tmpdata2[idx];
                            drawscatter(team1_detail.GAME_ID);
                            detail(team1_detail,team2_detail);
                            moreinfo(team1_detail,team2_detail);
                        })

                        .attr("id","circle1_"+i)
                        .attr("transform","translate(0,0)")
                        .attr("r", 6)
                        .attr("opacity", 0)
                        .transition()
                        .duration(1500)
                        .attr("cx", function(){ return x(tmpdata1[i].GAME_DATE); })
                        .attr("opacity", 0.8)
                        .attr("cy", function(){ return y(tmpdata1[i].PTS);})
                        .attr("fill","#DA70D6");

                svg.append("g")
                        .append("circle")
                        .on("mouseover",function(){
                            var cur_id = d3.select(this).attr("id");
                            var idx = cur_id.split("_")[1]
                            //console.log(idx);
                            var team1_detail = tmpdata1[idx];
                            var team2_detail = tmpdata2[idx];
                            drawscatter(team1_detail.GAME_ID);
//                            negativeBarChart(team1_detail, team2_detail);
                            detail(team1_detail,team2_detail);
                            moreinfo(team1_detail,team2_detail);
                        })
                        .attr("id","circle2_"+i)
                        .attr("transform","translate(0,0)")
                        .attr("r", 6)
                        .attr("opacity", 0)
                        .transition()
                        .duration(1500)
                        .attr("cx", function(){ return x(tmpdata2[i].GAME_DATE); })
                        .attr("opacity", 0.8)
                        .attr("cy", function(){ return y(tmpdata2[i].PTS); })
                        .attr("fill","#1E90FF");
                if(i != 0){
                    svg.append("g")
                            .append("line")
                            .attr("x1",x(tmpdata1[i-1].GAME_DATE))
                            .attr("y1",y(tmpdata1[i-1].PTS))
                            .attr("x2",x(tmpdata1[i].GAME_DATE))
                            .attr("y2",y(tmpdata1[i].PTS))
                            .attr("opacity", 0)
                            .transition()
                            .duration(2300)
                            .attr("opacity", 1)
                            .attr("stroke","#DA70D6")
                    svg.append("g")
                            .append("line")
                            .attr("x1",x(tmpdata2[i-1].GAME_DATE))
                            .attr("y1",y(tmpdata2[i-1].PTS))
                            .attr("x2",x(tmpdata2[i].GAME_DATE))
                            .attr("y2",y(tmpdata2[i].PTS))
                            .attr("opacity", 0)
                            .transition()
                            .duration(2300)
                            .attr("opacity", 1)
                            .attr("stroke","#1E90FF")
                }
            }
        })
    }
    function negativeBarChart(team1, team2) {
        document.getElementById("teambar").innerHTML="";
        console.log(document.getElementById("teambar"));
//        console.log(team2);
        var data = [];
        data.push({ name : "Assists", value:(team1.AST-team2.AST)/(team1.AST+team2.AST)});
        data.push({ name : "Blocks", value:(team1.BLK-team2.BLK)/(team1.BLK+team2.BLK)});
        data.push({ name : "Defensive Rebounds", value:(team1.DREB-team2.DREB)/(team1.DREB+team2.DREB)});
        data.push({ name : "Three Point Field Goal Percentage", value:(team1.FG3_PCT-team2.FG3_PCT)});
        data.push({ name : "Field Goal Percentage", value:(team1.FG_PCT-team2.FG_PCT)});
        data.push({ name : "Free Throw Percentage", value:(team1.FT_PCT-team2.FT_PCT)});
        data.push({ name : "Rebounds", value:(team1.REB-team2.REB)/(team1.REB+team2.REB)});
        data.push({ name : "Offensive Rebounds", value:(team1.OREB-team2.OREB)/(team1.OREB+team2.OREB)});
        data.push({ name : "Steal", value:(team1.STL-team2.STL)/(team1.STL+team2.STL)});
        data.push({ name : "Turnover", value:(team1.TOV-team2.TOV)/(team1.TOV+team2.TOV)});
//        console.log(data);

        var margin = {top: 20, right: 30, bottom: 40, left: 30},
                width = 960 - margin.left - margin.right,
                height = 300 - margin.top - margin.bottom;

        var x = d3.scale.linear()
                .range([0, width]);

        var y = d3.scale.ordinal()
                .rangeRoundBands([0, height], 0.1);

        var xAxis = d3.svg.axis()
                .scale(x)
                .orient("bottom");

        var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left")
                .tickSize(0)
                .tickPadding(6);


        var svg = d3.select("#teambar").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
            data.sort(function(a,b){return b.value - a.value});
        console.log(data);

            x.domain(d3.extent(data, function(d) { return d.value; })).nice();
            y.domain(data.map(function(d) { return d.name; }));

            svg.selectAll(".bar")
                    .data(data)
                    .enter().append("rect")
                    .attr("class", function(d) { return "bar bar--" + (d.value < 0 ? "negative" : "positive"); })
                    .attr("x", function(d) { return x(Math.min(0, d.value)); })
                    .attr("y", function(d) { return y(d.name); })
                    .attr("width", function(d) { return Math.abs(x(d.value) - x(0)); })
                    .attr("height", y.rangeBand());

            svg.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(xAxis);

            svg.append("g")
                    .attr("class", "y axis")
                    .attr("transform", "translate(" + x(0) + ",0)")
                    .call(yAxis);
            svg.append("g")
                    .append("circle")
                    .attr("fill","")

    }

    //calendarChart();
    function calendarChart(team) {

        var title="Calendar of Game";
        var breaks=[-30,-10,0,10, 30];
        var colours=["#de2d26","#fc9272","#fee0d2","#e5f5e0","#a1d99b", "#31a354"];
        var content = ["heavily lose", "common lose", "slightly lose", "slightly win", "common win", "heavily win"]

        //general layout information
        var cellSize = 15;
        var xOffset=20;
        var yOffset=60;
        var calY=50;//offset of calendar in each group
        var calX=25;
        var width = 960;
        var height = 100;
        var parseDate = d3.time.format("%m/%d/%y").parse;
        format = d3.time.format("%d-%m-%Y");
        toolDate = d3.time.format("%m/%d/%y");
        var teamname = 'GSW';
        d3.csv("data.csv", function(error, data) {

            //set up an array of all the dates in the data which we need to work out the range of the data
            var dates = new Array();
            var values = new Array();
            //parse the data
            data.forEach(function(d)    {
                if (d.TEAM_ABBREVIATION === teamname) {
//                console.log(d.GAME_DATE);
//                console.log(parseDate(d.GAME_DATE));
                    dates.push(parseDate(d.GAME_DATE));
                    values.push(d.PLUS_MINUS);
                    d.GAME_DATE=parseDate(d.GAME_DATE);
                    d.PLUS_MINUS= +d.PLUS_MINUS;

                    d.year=d.GAME_DATE.getFullYear();//extract the year from the data
                }

            });

            var yearlyData = d3.nest()
                    .key(function(d){return d.year;})
                    .entries(data);
            yearlyData.splice(-1);

            var svg = d3.select("#compare").append("svg")
                    .attr("width","90%")
                    .attr("viewBox","0 0 "+(xOffset+width)+" 540")

            //title
            svg.append("text")
                    .attr("x",xOffset)
                    .attr("y",20)
                    .text(title);
//            console.log(yearlyData);
            //create an SVG group for each year
            var cals = svg.selectAll("g")
                    .data(yearlyData)
                    .enter()
                    .append("g")
                    .attr("id",function(d){
                        return d.key;
                    })
                    .attr("transform",function(d,i){
                        return "translate(0,"+(yOffset+(i*(height+calY)))+")";
                    })

            var labels = cals.append("text")
                    .attr("class","yearLabel")
                    .attr("x",xOffset)
                    .attr("y",15)
                    .text(function(d){return d.key});

            //create a daily rectangle for each year
            var rects = cals.append("g")
                    .attr("id","alldays")
                    .selectAll(".day")
                    .data(function(d) { return d3.time.days(new Date(parseInt(d.key), 0, 1), new Date(parseInt(d.key) + 1, 0, 1)); })
                    .enter().append("rect")
                    .attr("id",function(d) {
                        return "_"+format(d);
                        //return toolDate(d.date)+":\n"+d.value+" dead or missing";
                    })
                    .attr("class", "day")
                    .attr("width", cellSize)
                    .attr("height", cellSize)
                    .attr("x", function(d) {
                        return xOffset+calX+(d3.time.weekOfYear(d) * cellSize);
                    })
                    .attr("y", function(d) { return calY+(d.getDay() * cellSize); })
                    .datum(format);

            //create day labels
            var days = ['Su','Mo','Tu','We','Th','Fr','Sa'];
            var dayLabels=cals.append("g").attr("id","dayLabels")
            days.forEach(function(d,i)    {
                dayLabels.append("text")
                        .attr("class","dayLabel")
                        .attr("x",xOffset)
                        .attr("y",function(d) { return calY+(i * cellSize); })
                        .attr("dy","0.9em")
                        .text(d);
            })

            //let's draw the data on
            var dataRects = cals.append("g")
                    .attr("id","dataDays")
                    .selectAll(".dataday")
                    .data(function(d){
                        return d.values;
                    })
                    .enter()
                    .append("rect")
                    .attr("id",function(d) {
//                    console.log(d);
                        return format(d.GAME_DATE)+":"+d.PLUS_MINUS;
                    })
                    .attr("stroke","#ccc")
                    .attr("width",cellSize)
                    .attr("height",cellSize)
                    .attr("x", function(d){return xOffset+calX+(d3.time.weekOfYear(d.GAME_DATE) * cellSize);})
                    .attr("y", function(d) { return calY+(d.GAME_DATE.getDay() * cellSize); })
                    .attr("fill", function(d) {
                        if (d.PLUS_MINUS<breaks[0]) {
//                            console.log(colours[0]);
                            return colours[0];
                        }
                        for (i=1;i<breaks.length;i++){
                            if (d.PLUS_MINUS>=breaks[i - 1]&&d.PLUS_MINUS<breaks[i]){
                                return colours[i];
                            }
                        }
                        if (d.PLUS_MINUS>=breaks[breaks.length-1]){
                            return colours[breaks.length];
                        }
                    })
                    .on('click', function(d){
                        this.setAttribute("class", "selected");
                        drawscatter(d.GAME_ID);
                    })

            //append a title element to give basic mouseover info
            dataRects.append("title")
                    .text(function(d) { return toolDate(d.GAME_DATE)+":\n"+teamname + ":" + d.PTS + " VS " + d.MATCHUP.slice(-3) +":" + (d.PTS - d.PLUS_MINUS); });

            //add montly outlines for calendar
            cals.append("g")
                    .attr("id","monthOutlines")
                    .selectAll(".month")
                    .data(function(d) {
                        return d3.time.months(new Date(parseInt(d.key), 0, 1),
                                new Date(parseInt(d.key) + 1, 0, 1));
                    })
                    .enter().append("path")
                    .attr("class", "month")
                    .attr("transform","translate("+(xOffset+calX)+","+calY+")")
                    .attr("d", monthPath);

            //retreive the bounding boxes of the outlines
            var BB = new Array();
            var mp = document.getElementById("monthOutlines").childNodes;
            for (var i=0;i<mp.length;i++){
                BB.push(mp[i].getBBox());
            }

            var monthX = new Array();
            BB.forEach(function(d,i){
                boxCentre = d.width/2;
                monthX.push(xOffset+calX+d.x+boxCentre);
            })

            //create centred month labels around the bounding box of each month path
            //create day labels
            var months = ['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC'];
            var monthLabels=cals.append("g").attr("id","monthLabels")
            months.forEach(function(d,i)    {
                monthLabels.append("text")
                        .attr("class","monthLabel")
                        .attr("x",monthX[i])
                        .attr("y",calY/1.2)
                        .text(d);
            })

            //create key
            var key = svg.append("g")
                    .attr("id","key")
                    .attr("class","key")
                    .attr("transform",function(d){
                        return "translate("+xOffset+","+(yOffset-(cellSize*1.5))+")";
                    });

            key.selectAll("rect")
                    .data(colours)
                    .enter()
                    .append("rect")
                    .attr("width",cellSize)
                    .attr("height",cellSize)
                    .attr("x",function(d,i){
                        return i*130;
                    })
                    .attr("fill",function(d){
                        return d;
                    });

            key.selectAll("text")
                    .data(colours)
                    .enter()
                    .append("text")
                    .attr("x",function(d,i){
                        return cellSize+5+(i*130);
                    })
                    .attr("y","1em")
                    .text(function(d,i){
                        return content[i];
//                    if (i<colours.length-1){
//                        return content[i];
//                    }   else    {
//                        return "over "+breaks[i-1];
//                    }
                    });

        });//end data load

        //pure Bostock - compute and return monthly path data for any year
        function monthPath(t0) {
            var t1 = new Date(t0.getFullYear(), t0.getMonth() + 1, 0),
                    d0 = t0.getDay(), w0 = d3.time.weekOfYear(t0),
                    d1 = t1.getDay(), w1 = d3.time.weekOfYear(t1);
            return "M" + (w0 + 1) * cellSize + "," + d0 * cellSize
                    + "H" + w0 * cellSize + "V" + 7 * cellSize
                    + "H" + w1 * cellSize + "V" + (d1 + 1) * cellSize
                    + "H" + (w1 + 1) * cellSize + "V" + 0
                    + "H" + (w0 + 1) * cellSize + "Z";
        }
    }
    function moreinfo(team1_detail,team2_detail){
//        console.log(team1_detail);
        google.charts.load('current', {'packages':['corechart','gauge']});
        moreinfo_draw(team1_detail,"moreinfo1");
        moreinfo_draw(team2_detail,"moreinfo2");
        clear_gauge();
        gauge_text();
        gauge_draw(team1_detail,"gauge1","#DA70D6",2);
        gauge_draw(team1_detail,"gauge2","#DA70D6",3);
        gauge_draw(team1_detail,"gauge3","#DA70D6",1);
        gauge_draw(team2_detail,"gauge4","#1E90FF",2);
        gauge_draw(team2_detail,"gauge5","#1E90FF",3);
        gauge_draw(team2_detail,"gauge6","#1E90FF",1);        
    }
    function clear_gauge(){
        document.getElementById("gaugetext").innerHTML="";
        document.getElementById("gauge1").innerHTML="";
        document.getElementById("gauge2").innerHTML="";
        document.getElementById("gauge3").innerHTML="";
        document.getElementById("gauge4").innerHTML="";
        document.getElementById("gauge5").innerHTML="";
        document.getElementById("gauge6").innerHTML="";
    }



    function moreinfo_draw(game, selector){
//      console.log(game)
      // google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);
      function drawChart() {

        var data = google.visualization.arrayToDataTable([
          ['Score Type', 'Score'],
          ['Field Goal',game.FGM*2],
          ['Three Point Field Goal',game.FG3M*3],
          ['Free Throws',  game.FTM]
        ]);

        var options = {
          title: game.TEAM_NAME+' Score Structure',
          height : 250,
          width : 1000,
          fontSize : 14,
          titleTextStyle : {fontSize: 14, italic: true},
          chartArea : {left:400,top:50,width:'100%',height:'100%'}
        };

        var chart = new google.visualization.PieChart(document.getElementById(selector));
        chart.draw(data, options);


        }
    }
    function gauge_text(){
        var svg = d3.select("#gaugetext")
        svg.append("g")
            .append("text")
            .attr("x",50)
            .attr("y",50)
            .attr("fill","black")
            .text("Field Goal Hit Rate")
            .attr("font-size","12px")
        svg.append("g")
            .append("text")
            .attr("x",660)
            .attr("y",50)
            .attr("fill","black")
            .text("Field Goal Hit Rate")
            .attr("font-size","12px")
        svg.append("g")
            .append("text")
            .attr("x",250)
            .attr("y",50)
            .attr("fill","black")
            .text("Three Point Hit Rate")
            .attr("font-size","12px")
        svg.append("g")
            .append("text")
            .attr("x",860)
            .attr("y",50)
            .attr("fill","black")
            .text("Three Point Hit Rate")
            .attr("font-size","12px")
        svg.append("g")
            .append("text")
            .attr("x",450)
            .attr("y",50)
            .attr("fill","black")
            .text("Free Throws Hit Rate")
            .attr("font-size","12px")
        svg.append("g")
            .append("text")
            .attr("x",1060)
            .attr("y",50)
            .attr("fill","black")
            .text("Free Throws Hit Rate")
            .attr("font-size","12px")
    }
    function gauge_draw(game, selector,color,i){
        
    //   google.charts.setOnLoadCallback(drawChart);
    //   function drawChart() {
    //     var ht2 = Math.round(100*game.FGM/game.FGA);
    //     var ht3 = Math.round(100*game.FG3M/game.FG3A);
    //     var ht1 = Math.round(100*game.FTM/game.FTA);
    //     var data = google.visualization.arrayToDataTable([
    //       ['Label', 'Value'],
    //       ['FG Hit Rate', ht2],
    //       ['FG3 Hit Rate', ht3],
    //       ['FT Hit Rate', ht1]
    //     ]);

    //     var options = {
    //       width: 500, height: 120,
    //       minorTicks: 5
    //     };

    //     var chart = new google.visualization.Gauge(document.getElementById(selector));

    //     chart.draw(data, options);
    // }
    var ht2 = Math.round(100*game.FGM/game.FGA);
    var ht3 = Math.round(100*game.FG3M/game.FG3A);
    var ht1 = Math.round(100*game.FTM/game.FTA);
    
    var config = liquidFillGaugeDefaultSettings();
    config.circleColor = color;
    config.textColor = "#553300";
    config.waveTextColor = "#553300";
    config.waveColor = color;
    config.circleThickness = 0.2;
    config.textVertPosition = 0.2;
    config.textVertPosition = 0.8;
    config.waveAnimateTime = 2000;
    config.waveHeight = 0.15;
    config.waveCount = 2;
    if (i == 2){
        var gauge = loadLiquidFillGauge(selector, ht2,config);
    }
    if (i == 3){
        var gauge = loadLiquidFillGauge(selector, ht3,config);
    } 
    if (i == 1){
        var gauge = loadLiquidFillGauge(selector, ht1,config);
    }
  }

  

    function filter(data, team1, team2){
        var data1 = []
        var data2 = []
        for (var i = 0; i < data.length; i++){
            var matchup = data[i].MATCHUP;
            var tmp1 = matchup.substring(0,3);
            var tmp2 = matchup.substring(matchup.length-3,matchup.length);
            if (tmp1 == team1 && tmp2 == team2){
                data1.push(data[i]);
            }
            if (tmp1 == team2 && tmp2 == team1){
                data2.push(data[i]);
            }
        }
        return [data1,data2]
    }
    // function test(game){
    //     //console.log(game);
    // }
    function detail(team1_detail,team2_detail){
        negativeBarChart(team1_detail, team2_detail);
        detail_1(team1_detail);
        detail_2(team2_detail);
    }

    function detail_1(game){
        //console.log(game);
        var width = 500;
        var height = 450;
        var svg = d3.select("#team1")
        var g = svg.select('g');
        if (!svg.empty()) {
            svg.select('svg').remove()

        }
        var svg = d3.select("#team1")
                .append("svg")
                .attr("width",width+100)
                .attr("height",height)
                .append("g")
                .attr("transform","translate(100,30)")
        var y = 0;
        var delay = 0;
        svg.append("g")
                .append("rect")
                .attr("x",500-4*game.FGA)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.FGA)
                .attr("stroke","#DA70D6")
                .attr("fill","#DA70D6")
                .attr("opacity", delay)
                .transition()
                .duration(0)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",380-4*game.FGA)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", delay)
                .text("Field Goal Attempt"+" ("+game.FGA+")")
                .attr("font-size","10px")
                .transition()
                .duration(0)
                .attr("opacity", 1)

        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",500-4*game.FGM)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.FGM)
                .attr("stroke","#DA70D6")
                .attr("fill","#DA70D6")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",380-4*game.FGM)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Field Goal Made"+" ("+game.FGM+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)

        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",500-4*game.FG3A)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.FG3A)
                .attr("stroke","#DA70D6")
                .attr("fill","#DA70D6")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",330-4*game.FG3A)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Three Point Field Goal Attempt"+" ("+game.FG3A+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)

        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",500-4*game.FG3M)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.FG3M)
                .attr("stroke","#DA70D6")
                .attr("fill","#DA70D6")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",350-4*game.FG3M)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Three Point Field Goal Made"+" ("+game.FG3M+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)

        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",500-4*game.FTA)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.FTA)
                .attr("stroke","#DA70D6")
                .attr("fill","#DA70D6")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",380-4*game.FTA)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Free Throws Attempt"+" ("+game.FTA+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)


        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",500-4*game.FTM)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.FTM)
                .attr("stroke","#DA70D6")
                .attr("fill","#DA70D6")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",380-4*game.FTM)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Free Throws Made"+" ("+game.FTM+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)

        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",500-4*game.OREB)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.OREB)
                .attr("stroke","#DA70D6")
                .attr("fill","#DA70D6")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",380-4*game.OREB)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Offensive Rebounds"+" ("+game.OREB+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)

        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",500-4*game.DREB)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.DREB)
                .attr("stroke","#DA70D6")
                .attr("fill","#DA70D6")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",380-4*game.DREB)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Defensive Rebounds"+" ("+game.DREB+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)

        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",500-4*game.REB)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.REB)
                .attr("stroke","#DA70D6")
                .attr("fill","#DA70D6")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",420-4*game.REB)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Rebounds"+" ("+game.REB+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",500-4*game.AST)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.AST)
                .attr("stroke","#DA70D6")
                .attr("fill","#DA70D6")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",420-4*game.AST)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Assists"+" ("+game.AST+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)

        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",500-4*game.STL)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.STL)
                .attr("stroke","#DA70D6")
                .attr("fill","#DA70D6")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",420-4*game.STL)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Steals"+" ("+game.STL+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)

        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",500-4*game.BLK)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.BLK)
                .attr("stroke","#DA70D6")
                .attr("fill","#DA70D6")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",420-4*game.BLK)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Blocks"+" ("+game.BLK+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)

        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",500-4*game.TOV)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.TOV)
                .attr("stroke","#DA70D6")
                .attr("fill","#DA70D6")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",420-4*game.TOV)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Turnovers"+" ("+game.TOV+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)
    }
    function detail_2(game){
        var width = 500;
        var height = 450;
        var svg = d3.select("#team2")
        var g = svg.select('g');
        if (!svg.empty()) {
            svg.select('svg').remove()

        }
        var svg = d3.select("#team2")
                .append("svg")
                .attr("width",width)
                .attr("height",height)
                .append("g")
                .attr("transform","translate(0,30)")
        var x = d3.scale.linear()
                .range([0,width-100]);
        var y = 0;
        var delay = 0;
        svg.append("g")
                .append("rect")
                .attr("x",0)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.FGA)
                .attr("stroke","#1E90FF")
                .attr("fill","#1E90FF")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",4*game.FGA+20)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Field Goal Attempt"+" ("+game.FGA+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)

        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",0)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.FGM)
                .attr("stroke","#1E90FF")
                .attr("fill","#1E90FF")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",4*game.FGM+20)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Field Goal Made"+" ("+game.FGM+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)

        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",0)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.FG3A)
                .attr("stroke","#1E90FF")
                .attr("fill","#1E90FF")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",4*game.FG3A+20)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Three Point Field Goal Attempt"+" ("+game.FG3A+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)

        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",0)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.FG3M)
                .attr("stroke","#1E90FF")
                .attr("fill","#1E90FF")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",4*game.FG3M+20)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Three Point Field Goal Made"+" ("+game.FG3M+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)

        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",0)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.FTA)
                .attr("stroke","#1E90FF")
                .attr("fill","#1E90FF")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",4*game.FTA+20)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Free Throws Attempt"+" ("+game.FTA+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)


        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",0)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.FTM)
                .attr("stroke","#1E90FF")
                .attr("fill","#1E90FF")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",4*game.FTM+20)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Free Throws Made"+" ("+game.FTM+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)

        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",0)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.OREB)
                .attr("stroke","#1E90FF")
                .attr("fill","#1E90FF")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",4*game.OREB+20)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Offensive Rebounds"+" ("+game.OREB+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)


        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",0)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.DREB)
                .attr("stroke","#1E90FF")
                .attr("fill","#1E90FF")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",4*game.DREB+20)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Defensive Rebounds"+" ("+game.DREB+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)

        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",0)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.REB)
                .attr("stroke","#1E90FF")
                .attr("fill","#1E90FF")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",4*game.REB+20)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Rebounds"+" ("+game.REB+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)

        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",0)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.AST)
                .attr("stroke","#1E90FF")
                .attr("fill","#1E90FF")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",4*game.AST+20)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Assists"+" ("+game.AST+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)

        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",0)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.STL)
                .attr("stroke","#1E90FF")
                .attr("fill","#1E90FF")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",4*game.STL+20)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Steals"+" ("+game.STL+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)

        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",0)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.BLK)
                .attr("stroke","#1E90FF")
                .attr("fill","#1E90FF")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",4*game.BLK+20)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Blocks"+" ("+game.BLK+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)

        y += 30
        svg.append("g")
                .append("rect")
                .attr("x",0)
                .attr("y",y)
                .attr("height",20)
                .attr("width",4*game.TOV)
                .attr("stroke","#1E90FF")
                .attr("fill","#1E90FF")
                .attr("opacity", 0)
                .transition()
                .duration(delay)
                .attr("opacity", 1)
        svg.append("g")
                .append("text")
                .attr("x",4*game.TOV+20)
                .attr("y",y+12)
                .attr("fill","black")
                .attr("opacity", 0)
                .text("Turnovers"+" ("+game.TOV+")")
                .attr("font-size","10px")
                .transition()
                .duration(delay)
                .attr("opacity", 1)
    }

    var team;
    var margin = {left:30, right : 30, top:300, bottom: 0};
    var width = 1100 + margin.left + margin.right,
            height = 100 + margin.top + margin.bottom;


    //Define map projection
    var projection = d3.geo.albersUsa()
            .translate([width/3, height/3.5 + 80])
            .scale([900]);


    //Define path generator
    var path = d3.geo.path()
            .projection(projection);

    //Map the winrate to opacity[0.3, 0.9]
    var Opacity = d3.scale.linear()
            .range([0.2, 0.9]);

    //Map the rank to radius[2, 20]
    var Scale = d3.scale.linear()
            .range([2, 20]);

    //Create SVG element
    var svg = d3.select("body")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .on("click", stopped, true);

    //Creater a group to store states
    var g = svg.append("g")
            .attr("class","map");

    var div = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

    //Load in state data, draw the map
    d3.csv("US-states.csv", function(data) {
        //Load in GeoJSON data
        d3.json("US-geo.json", function(json) {
            //Merge the EastorWest data and GeoJSON
            //Loop through once for each EastorWest data value

            for (var i = 0; i < data.length; i++) {
                var dataState = data[i].state;				//Grab state name
                var dataValue = parseFloat(data[i].value);	//Grab data value, and convert from string to float
                var dataEASTorWEST = data[i].EASTorWEST;
                //Find the corresponding state inside the GeoJSON
                for (var j = 0; j < json.features.length; j++) {
                    var jsonState = json.features[j].properties.name;
                    if (dataState == jsonState) {
                        //Copy the data value into the JSON
                        json.features[j].properties.EASTorWEST = dataEASTorWEST;
                        //Stop looking through the JSON
                        break;
                    }
                }
            }

            //Bind data and create one path per GeoJSON feature
            g.selectAll("path")
                    .data(json.features).enter()
                    .append("path")
                    .attr("stroke","white")
                    .attr("stroke-width",2)
                    .attr("d", path)
                    .attr("class", function(d) {
                        return d.properties.postal;})
                    .style("fill", function(d) {
                        //Get data value
                        var EASTorWEST = d.properties.EASTorWEST;
                        if (EASTorWEST) {
                            //If value exists…
                            if (EASTorWEST == "East") {
                                return "#C6E2FF";
                            } else {
                                return "#FFB6C1";
                            }
                        } else {
                            //If value is undefined…
                            return "#CCCCCC";
                        }
                    });
//                    .on("click", stateClick);
            //Load in NBA teams data
            d3.csv("NBA-teams.csv", function(data) {
                //Map the rank to radius[2, 20]
                Scale.domain([0, d3.max(data, function(d) { return d.winrate; })]);

                //Map the rank to opacity[0.3, 0.9]
                Opacity.domain([0, d3.max(data, function(d) { return d.winrate; })]);
                //Create nodes group
                var nodes = g.selectAll("nodes")
                        .data(data)
                        .enter()
                        .append("g")
                        .attr("class", "team")
                        .attr("transform", function(d) {
                            return "translate(" + projection([d.lon, d.lat])[0] + "," + projection([d.lon, d.lat])[1] + ")";});

                var teamList = [];

                //Circles for teams
                nodes.append("circle")
                        .attr("class", "AllCircle")
                        .attr("r", function(d){return d.winrate/10 +3;})
                        .style("fill", function(d){
                            if (d.EASTorWEST == "East") {
                                return "blue";
                            } else {
                                return "red";
                            };
                        })
                        .style("opacity", 0.8)
                        .attr("stroke","white")
                        .attr("stroke-width",0.5)
                        .on("mouseover",function(d){
//                            console.log(d.teamname);
//                            console.log(d3.event.pageX);
//                            console.log(d3.event.pageY);
                            div.transition()
                                    .duration(200)
                                    .style("opacity", .9);
                            div.html(d.teamname)
                                    .style("left",d3.event.pageX)
                                    .style("top",d3.event.pageY);
                        })
                        .on("mouseout", function(d){
                            div.transition()
                                    .duration(500)
                                    .style("opacity", 0);
                        })
                        .on("click", function(d){
//                            d3.selectAll("circle").style("fill",function(d){
//                                if (d.EASTorWEST == "East") {
//                                    return "blue";
//                                } else {
//                                    return "red";
//                                };
//                            });
                            team = d.abb;
                            var color;
                            if (teamList.indexOf(team)==-1 && teamList.length >= 2) {
                                alert("Cannot select more than two teams");
                                return;
                            } else if (teamList.indexOf(team) == -1 && teamList.length < 2) {

                                teamList.push(team);
                                color = 'yellow';
                            } else if (teamList.indexOf(team)!= -1) {
                                if (d.EASTorWEST == 'East'){
                                    color = 'blue';
                                } else {
                                    color = 'red';
                                }
                                teamList.splice(teamList.indexOf(team), 1);
                            }
                            d3.select(this).style("fill", color);
                            if (teamList.length == 0) {
                                document.getElementById("calendar").innerHTML="";
                            }
                            if (teamList.length == 1) {
                                calendarChart(teamList[0]);
                            }
                            if (teamList.length == 2) {
                                compare(teamList);
                                document.getElementById("team1").innerHTML="";
                                document.getElementById("team2").innerHTML="";
                                document.getElementById("teambar").innerHTML="";
                                document.getElementById("calendar").innerHTML="";
                            } else {
//                                console.log("d3.selectAll()");
//                                console.log(d3.selectAll("#lineChart"));
//                                console.log((document.getElementsByClassName("lineChart")));
                                document.getElementById("compare").innerHTML="";
                                document.getElementById("teambar").innerHTML="";
                                document.getElementById("team1").innerHTML="";
                                document.getElementById("team2").innerHTML="";
                            }
                            svg.selectAll("g.barChart").remove();
                            svg.selectAll("g.randar").remove();
                            d3.selectAll("svg.scatter").remove();
//                            console.log(teamList);
                            drawRandarChart(teamList,[0,900]);
                        });
//                        .style("cursor", "pointer")

                //Text for temm abbreviation
                nodes.append("text")
                        .attr("class", function(d) {
                            return "text " + d.abb;})
                        .attr("dx", function(d){
                            return Scale(d.winrate);})
                        .attr("dy", ".3em")
                        .attr("font-size", 13)
                        .style("fill", "#888888")
                        .style("font-weight", "bold")
                        .style("cursor", "default")
                        .text(function(d) {
                            return d.abb;});
            });
        });
    });
    function transit() {
        d3.selectAll(".AllCircle")
                .transition()
                .attr("r", function(d){
                    //console.log(d); d.abb
                    return 10;});
    }
    var parseDate = d3.time.format("%m/%d/%y").parse;
    //    var x = d3.time.scale().domain([parseDate("10/27/15"), parseDate("4/13/16")]).range([0,900]);
    var x = d3.scale.ordinal().rangeRoundBands([0, 900], .2);
    var y = d3.scale.linear().range([200, 0]);
    var div = d3.select(".bar").append("div");
    //change the position of the bar chart at end; Start to draw barChart/

    function stopped() {
        if (d3.event.defaultPrevented) {
            d3.event.stopPropagation();
        }
    }

    function drawRandarChart(key_list,range) {
        //console.log(key_list);
        d3.csv("data.csv", function (data) {
            x.domain(data.map(function (d) {
                return d.GAME_DATE;
            }));

            d_list = ['AST', 'BLK', 'STL', 'REB', 'TOV', 'DREB']

            //custome function

            function groupByArray(xs, key) { return xs.reduce(function (rv, x) { let v = key instanceof Function ? key(x) : x[key]; let el = rv.find((r) => r && r.key === v); if (el) { el.values.push(x); } else { rv.push({ key: v, values: [x] }); } return rv; }, []); }

            function add(a, b) {
                return a + b;
            }

            //parse the str into float
            data.map(function (d) {
                for (var i = 0; i < d_list.length; i++) {
                    d[d_list[i]] = parseFloat(d[d_list[i]]);
                }
            })


            data2 = groupByArray(data, ['TEAM_ABBREVIATION'])
            // data2 is the grouped data of each team, [{team1:[game1,game2]}], we could filt data2 laterly


            //data3 is the total ast for each team
            //data3 = data2.map(function(d){return d.values.map(function(dd){return dd.AST}).reduce(add,0)})

            //get team id here

            team_list = []
//            console.log(key_list.length);
            for (var j = 0; j < key_list.length; j++){

                var team = key_list[j];
//                console.log(team)
                //get team data
                teamd = data2.filter(function (d) {

                    return (d.key == team )
                })[0].values
                //check the sum for each axis
                //console.log(teamd.map(function(d){return d.AST}).reduce(add,0))
                teamd = teamd.filter(function(d){
//            console.log(d.GAME_DATE);
//            console.log(x(d.GAME_DATE));
                    return range[0] <= x(d.GAME_DATE) && x(d.GAME_DATE) <= range[1]
                });

                r_data = [];


                for (var i = 0; i < d_list.length; i++) {
                    max_i = Math.max.apply(null, data2.map(function (d) {
                        return d.values.filter(function(d){
//            console.log(d.GAME_DATE);
//            console.log(x(d.GAME_DATE));
                            return range[0] <= x(d.GAME_DATE) && x(d.GAME_DATE) <= range[1]
                        }).map(function (dd) {
                            return dd[d_list[i]]
                        }).reduce(add, 0)
                    }));
                    team_i = teamd.map(function (d) {
                        return d[d_list[i]]
                    }).reduce(add, 0)
                    r_data.push({axis: d_list[i], value: team_i / max_i})

                }
//                console.log(i);
                team_list.push(r_data)
            }
//            console.log(team_list)




            //code from cinnamon

            var margin = {top: 100, right: 100, bottom: 100, left: 100},
                    width = Math.min(500, window.innerWidth - 10) - margin.left - margin.right,
                    height = Math.min(width, window.innerHeight - margin.top - margin.bottom - 20);
            //replace the data here
            var data = team_list;

            var color = d3.scale.ordinal()
                    .range(["#EDC951", "#CC333F", "#00A0B0"]);

            var radarChartOptions = {
                w: width,
                h: height,
                margin: margin,
                maxValue: 0.5,
                levels: 5,
                roundStrokes: true,
                color: color
            };
            //Call function to draw the Radar chart
            RadarChart(".radarChart", data, radarChartOptions);


            function RadarChart(id, data, options) {
                var cfg = {
                    w: 600,				//Width of the circle
                    h: 600,				//Height of the circle
                    margin: {top: 20, right: 20, bottom: 20, left: 20}, //The margins of the SVG
                    levels: 3,				//How many levels or inner circles should there be drawn
                    maxValue: 0, 			//What is the value that the biggest circle will represent
                    labelFactor: 1.25, 	//How much farther than the radius of the outer circle should the labels be placed
                    wrapWidth: 60, 		//The number of pixels after which a label needs to be given a new line
                    opacityArea: 0.35, 	//The opacity of the area of the blob
                    dotRadius: 4, 			//The size of the colored circles of each blog
                    opacityCircles: 0.1, 	//The opacity of the circles of each blob
                    strokeWidth: 2, 		//The width of the stroke around each blob
                    roundStrokes: false,	//If true the area and stroke will follow a round path (cardinal-closed)
                };
                var cfgcolor = ['#DA70D6', '#1E90FF'];

                //Put all of the options into a variable called cfg
                if ('undefined' !== typeof options) {
                    for (var i in options) {
                        if ('undefined' !== typeof options[i]) {
                            cfg[i] = options[i];
                        }
                    }//for i
                }//if

                //If the supplied maxValue is smaller than the actual one, replace by the max in the data
                var maxValue = Math.max(cfg.maxValue, d3.max(data, function (i) {
                    return d3.max(i.map(function (o) {
                        return o.value;
                    }))
                }));

                var allAxis = (data[0].map(function (i, j) {
                            return i.axis
                        })),	//Names of each axis
                        total = allAxis.length,					//The number of different axes
                        radius = Math.min(cfg.w / 2, cfg.h / 2), 	//Radius of the outermost circle
                        Format = d3.format('%'),			 	//Percentage formatting
                        angleSlice = Math.PI * 2 / total;		//The width in radians of each "slice"

                //Scale for the radius
                var rScale = d3.scale.linear()
                        .range([0, radius])
                        .domain([0, maxValue]);

                /////////////////////////////////////////////////////////
                //////////// Create the container SVG and g /////////////
                /////////////////////////////////////////////////////////

                //Remove whatever chart with the same id/class was present before
                d3.select(id).select("svg").remove();

                //Initiate the radar chart SVG
//	var svg = d3.select("body").append("svg")
//			.attr("width",  cfg.w + cfg.margin.left + cfg.margin.right)
//			.attr("height", cfg.h + cfg.margin.top + cfg.margin.bottom)
//			.attr("class", "radar"+id);
                //Append a g element

                //var g = svg.append("g")
                //      .attr("class", "randar")
                //    .attr("transform", "translate(" + (cfg.w / 2 + cfg.margin.left) + "," + (cfg.h / 2 + cfg.margin.top) + ")");

                //var svg = d3.select("body").append("svg")
                //		.attr("width",  cfg.w + cfg.margin.left + cfg.margin.right)
                //		.attr("height", cfg.h + cfg.margin.top + cfg.margin.bottom)
                //		.attr("class", "radar"+id);
                //Append a g element
                //这里修改了一下，直接在同一个svg上画雷达图
                d3.selectAll("g.randar").remove();
                var g = svg.append("g")
                        .attr("class", "randar")
                        .attr("transform", "translate(" + (cfg.w / 2 + cfg.margin.left + 700) + "," + (cfg.h / 2 + cfg.margin.top) + ")");
                svg.append("text")
                        .attr("x",0)
                        .attr("y", 30)
                        .text("Game Statistic")
                        .attr("font-family", "sans-serif")
                        .attr("font-size", "20px")
                        .attr("fill", "black")
                        .attr("transform", "translate(" + (cfg.w / 2 + cfg.margin.left + 650) + ",0)");
                /////////////////////////////////////////////////////////
                ////////// Glow filter for some extra pizzazz ///////////
                /////////////////////////////////////////////////////////

                //Filter for the outside glow
                var filter = g.append('defs').append('filter').attr('id', 'glow'),
                        feGaussianBlur = filter.append('feGaussianBlur').attr('stdDeviation', '2.5').attr('result', 'coloredBlur'),
                        feMerge = filter.append('feMerge'),
                        feMergeNode_1 = feMerge.append('feMergeNode').attr('in', 'coloredBlur'),
                        feMergeNode_2 = feMerge.append('feMergeNode').attr('in', 'SourceGraphic');

                /////////////////////////////////////////////////////////
                /////////////// Draw the Circular grid //////////////////
                /////////////////////////////////////////////////////////

                //Wrapper for the grid & axes
                var axisGrid = g.append("g").attr("class", "axisWrapper");

                //Draw the background circles
                axisGrid.selectAll(".levels")
                        .data(d3.range(1, (cfg.levels + 1)).reverse())
                        .enter()
                        .append("circle")
                        .attr("class", "gridCircle")
                        .attr("r", function (d, i) {
                            return radius / cfg.levels * d;
                        })
                        .style("fill", "#CDCDCD")
                        .style("stroke", "#CDCDCD")
                        .style("fill-opacity", cfg.opacityCircles)
                        .style("filter", "url(#glow)");

                //Text indicating at what % each level is
                axisGrid.selectAll(".axisLabel")
                        .data(d3.range(1, (cfg.levels + 1)).reverse())
                        .enter().append("text")
                        .attr("class", "axisLabel")
                        .attr("x", 4)
                        .attr("y", function (d) {
                            return -d * radius / cfg.levels;
                        })
                        .attr("dy", "0.4em")
                        .style("font-size", "10px")
                        .attr("fill", "#737373")
                        .text(function (d, i) {
                            return Format(maxValue * d / cfg.levels);
                        });

                /////////////////////////////////////////////////////////
                //////////////////// Draw the axes //////////////////////
                /////////////////////////////////////////////////////////

                //Create the straight lines radiating outward from the center
                var axis = axisGrid.selectAll(".axis")
                        .data(allAxis)
                        .enter()
                        .append("g")
                        .attr("class", "axis");
                //Append the lines
                axis.append("line")
                        .attr("x1", 0)
                        .attr("y1", 0)
                        .attr("x2", function (d, i) {
                            return rScale(maxValue * 1.1) * Math.cos(angleSlice * i - Math.PI / 2);
                        })
                        .attr("y2", function (d, i) {
                            return rScale(maxValue * 1.1) * Math.sin(angleSlice * i - Math.PI / 2);
                        })
                        .attr("class", "line")
                        .style("stroke", "white")
                        .style("stroke-width", "2px");

                //Append the labels at each axis
                axis.append("text")
                        .attr("class", "legend")
                        .style("font-size", "11px")
                        .attr("text-anchor", "middle")
                        .attr("dy", "0.35em")
                        .attr("x", function (d, i) {
                            return rScale(maxValue * cfg.labelFactor) * Math.cos(angleSlice * i - Math.PI / 2);
                        })
                        .attr("y", function (d, i) {
                            return rScale(maxValue * cfg.labelFactor) * Math.sin(angleSlice * i - Math.PI / 2);
                        })
                        .text(function (d) {
                            return d
                        })
                        .call(wrap, cfg.wrapWidth)
                        .on("click", function(d){
                            var t = d
//                        console.log(d);
                            //console.log(this);
                            d3.selectAll(".text_color").classed("text_color",false);
                            d3.select(this).classed("text_color",true);
//                        this.transition().style("font-size","22px");
                            svg.selectAll("g.barChart").remove();

                            d3.csv("data.csv", function (data) {
                                x.domain(data.map(function (d) {
                                    return d.GAME_DATE;
                                }));

                                d_list = ['AST', 'BLK', 'STL', 'REB', 'TOV', 'DREB']

                                //custome function

                                function groupByArray(xs, key) { return xs.reduce(function (rv, x) { let v = key instanceof Function ? key(x) : x[key]; let el = rv.find((r) => r && r.key === v); if (el) { el.values.push(x); } else { rv.push({ key: v, values: [x] }); } return rv; }, []); }

//                            svg.selectAll("g.barChart").remove();

                                function add(a, b) {
                                    return a + b;
                                }

                                //parse the str into float
                                data.map(function (d) {
                                    for (var i = 0; i < d_list.length; i++) {
                                        d[d_list[i]] = parseFloat(d[d_list[i]]);
                                    }
                                })


                                data2 = groupByArray(data, ['TEAM_ABBREVIATION'])
                                var tmp = {}
                                values = []
                                data2 = data2.map(function(d){
                                    tmp[d.key] = d.values.map(function(d){return d[t]}).reduce(add,0)
                                    values.push(d.values.map(function(d){return d[t]}).reduce(add,0))
//                                console.log(d.key)
//                                console.log(d.values.map(function(d){return d[t]}))
                                })
//                            console.log(tmp,d3.max(values))

                                d3.selectAll(".AllCircle")
                                        .transition()
                                        .attr("r", function(d){
                                            //console.log(d); d.abb
                                            return 10*tmp[d.abb]/d3.max(values)});
                            })

                        });

                /////////////////////////////////////////////////////////
                ///////////// Draw the radar chart blobs ////////////////
                /////////////////////////////////////////////////////////

                //The radial line function
                var radarLine = d3.svg.line.radial()
                        .interpolate("linear-closed")
                        .radius(function (d) {
                            return rScale(d.value);
                        })
                        .angle(function (d, i) {
                            return i * angleSlice;
                        });

                if (cfg.roundStrokes) {
                    radarLine.interpolate("cardinal-closed");
                }

                //Create a wrapper for the blobs
                var blobWrapper = g.selectAll(".radarWrapper")
                        .data(data)
                        .enter().append("g")
                        .attr("class", "radarWrapper");

                //Append the backgrounds
                blobWrapper
                        .append("path")
                        .attr("class", "radarArea")
                        .attr("d", function (d, i) {
                            return radarLine(d);
                        })
                        .style("fill", function (d, i) {
//                            console.log("iisha");
//                            console.log(i);
//                            console.log(color(i));
//                            console.log(cfg.color);
                            return cfgcolor[i];
                        })
                        .style("fill-opacity", cfg.opacityArea)
                        .on('mouseover', function (d, i) {
                            //Dim all blobs
                            d3.selectAll(".radarArea")
                                    .transition().duration(200)
                                    .style("fill-opacity", 0.1);
                            //Bring back the hovered over blob
                            d3.select(this)
                                    .transition().duration(200)
                                    .style("fill-opacity", 0.7);
                        })
                        .on('mouseout', function () {
                            //Bring back all blobs
                            d3.selectAll(".radarArea")
                                    .transition().duration(200)
                                    .style("fill-opacity", cfg.opacityArea);
                        });

                //Create the outlines
                blobWrapper.append("path")
                        .attr("class", "radarStroke")
                        .attr("d", function (d, i) {
                            return radarLine(d);
                        })
                        .style("stroke-width", cfg.strokeWidth + "px")
                        .style("stroke", function (d, i) {
                            return cfgcolor[i];
                        })
                        .style("fill", "none")
                        .style("filter", "url(#glow)");

                //Append the circles
                blobWrapper.selectAll(".radarCircle")
                        .data(function (d, i) {
                            return d;
                        })
                        .enter().append("circle")
                        .attr("class", "radarCircle")
                        .attr("r", cfg.dotRadius)
                        .attr("cx", function (d, i) {
                            return rScale(d.value) * Math.cos(angleSlice * i - Math.PI / 2);
                        })
                        .attr("cy", function (d, i) {
                            return rScale(d.value) * Math.sin(angleSlice * i - Math.PI / 2);
                        })
                        .style("fill", function (d, i, j) {
                            return cfgcolor[j];
                        })
                        .style("fill-opacity", 0.8);

                /////////////////////////////////////////////////////////
                //////// Append invisible circles for tooltip ///////////
                /////////////////////////////////////////////////////////


            //Append the backgrounds
            blobWrapper
                    .append("path")
                    .attr("class", "radarArea")
                    .attr("d", function (d, i) {
                        return radarLine(d);
                    })
                    .style("fill", function (d, i) {
//                        console.log(cfg.color)
                        return cfgcolor[i];
                    })
                    .style("fill-opacity", cfg.opacityArea)
                    .on('mouseover', function (d, i) {
                        //Dim all blobs
                        d3.selectAll(".radarArea")
                                .transition().duration(200)
                                .style("fill-opacity", 0.1);
                        //Bring back the hovered over blob
                        d3.select(this)
                                .transition().duration(200)
                                .style("fill-opacity", 0.7);
                    })
                    .on('mouseout', function () {
                        //Bring back all blobs
                        d3.selectAll(".radarArea")
                                .transition().duration(200)
                                .style("fill-opacity", cfg.opacityArea);
                    });

                //Wrapper for the invisible circles on top
                var blobCircleWrapper = g.selectAll(".radarCircleWrapper")
                        .data(data)
                        .enter().append("g")
                        .attr("class", "radarCircleWrapper");


                //Append a set of invisible circles on top for the mouseover pop-up
                blobCircleWrapper.selectAll(".radarInvisibleCircle")
                        .data(function (d, i) {
                            return d;
                        })
                        .enter().append("circle")
                        .attr("class", "radarInvisibleCircle")
                        .attr("r", cfg.dotRadius * 1.5)
                        .attr("cx", function (d, i) {
                            return rScale(d.value) * Math.cos(angleSlice * i - Math.PI / 2);
                        })
                        .attr("cy", function (d, i) {
                            return rScale(d.value) * Math.sin(angleSlice * i - Math.PI / 2);
                        })
                        .style("fill", "none")
                        .style("pointer-events", "all")
                        .on("mouseover", function (d, i) {
                            newX = parseFloat(d3.select(this).attr('cx')) - 10;
                            newY = parseFloat(d3.select(this).attr('cy')) - 10;

                            tooltip
                                    .attr('x', newX)
                                    .attr('y', newY)
                                    .text(Format(d.value))
                                    .transition().duration(200)
                                    .style('opacity', 1);
                        })
                        .on("mouseout", function () {
                            tooltip.transition().duration(200)
                                    .style("opacity", 0);
                        });

                //Set up the small tooltip for when you hover over a circle
                var tooltip = g.append("text")
                        .attr("class", "tooltip")
                        .style("opacity", 0);

                /////////////////////////////////////////////////////////
                /////////////////// Helper Function /////////////////////
                /////////////////////////////////////////////////////////

                //Taken from http://bl.ocks.org/mbostock/7555321
                //Wraps SVG text
                function wrap(text, width) {
                    text.each(function () {
                        var text = d3.select(this),
                                words = text.text().split(/\s+/).reverse(),
                                word,
                                line = [],
                                lineNumber = 0,
                                lineHeight = 1.4, // ems
                                y = text.attr("y"),
                                x = text.attr("x"),
                                dy = parseFloat(text.attr("dy")),
                                tspan = text.text(null).append("tspan").attr("x", x).attr("y", y).attr("dy", dy + "em");

                        while (word = words.pop()) {
                            line.push(word);
                            tspan.text(line.join(" "));
                            if (tspan.node().getComputedTextLength() > width) {
                                line.pop();
                                tspan.text(line.join(" "));
                                line = [word];
                                tspan = text.append("tspan").attr("x", x).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
                            }
                        }
                    });
                }//wrap

            }//RadarChart


//    	console.log(r_data)
            //t1 = data.filter(function(d){return (d.TEAM_ID == "1610612757");}).map(function (d) {return [d.GAME_DATE,parseFloat(d.PLUS_MINUS)]})
            //console.log(t1);

            //g1 = d3.select("body")
            //			.append("svg")
            //			.attr("width", 1500)
            //			.attr("height", 400);
            //			//.attr("transform", "translate(0,600)");
//
            //    lines = g1.selectAll("line")
            //        .data(t1)
            //        .enter()
            //        .append("line")
            //        .attr("x1", function(d,i){return i*50;})
            //        .attr("y1", function(d,i){return 20})
            //        .attr("x2", function(d,i){return i*50;})
            //        .attr("y2", function(d,i){return 200;})
            //        .attr("stroke-width",10)
            //        .attr("stroke",function(d,i){return ['red','blue'][(d[1]//>0)+0]});

        })
    }

function drawscatter(gameid){

	d3.csv("data2.csv", function(error, data) {
  var margin2 = {top: 20, right: 20, bottom: 30, left: 40},
    width2 = 960 - margin2.left - margin2.right,
    height2 = 500 - margin2.top - margin2.bottom;

/* 
 * value accessor - returns the value to encode for a given data object.
 * scale - maps value to a visual display encoding, such as a pixel position.
 * map function - maps from data value to display value
 * axis - sets up axis
 */ 

// setup x 
var xValue = function(d) { return d.MIN;}, // data -> value
    xScale = d3.scale.linear().range([0, width2]), // value -> display
    xMap = function(d) { return xScale(xValue(d));}, // data -> display
    xAxis = d3.svg.axis().scale(xScale).orient("bottom");

// setup y
var yValue = function(d) { return d["PTS"];}, // data -> value
    yScale = d3.scale.linear().range([height2, 0]), // value -> display
    yMap = function(d) { return yScale(yValue(d));}, // data -> display
    yAxis = d3.svg.axis().scale(yScale).orient("left");

// setup fill color
var cValue = function(d) { return d.TEAM_NAME;},
    color = d3.scale.category10();

// add the graph canvas to the body of the webpage
d3.selectAll("svg.scatter").remove();

var svg = d3.select("#scatter").append("svg")
    .attr("class","scatter")
    .attr("width", width2 + margin2.left + margin2.right)
    .attr("height", height2 + margin2.top + margin2.bottom)
  .append("g")
    .attr("transform", "translate(" + margin2.left + "," + margin2.top + ")");

// add the tooltip area to the webpage
var tooltip = d3.select("body").append("div")
    .attr("class", "tooltip2")
    .style("opacity", 0);

  // change string (from CSV) into number format
  data = data.filter(function(d){return d.GAME_ID == gameid});
  data.forEach(function(d) {
    d.MIN = +d.MIN;
    d["PTS"] = +d["PTS"];
//    console.log(d);
  });

  // don't want dots overlapping axis, so add in buffer to data domain
  xScale.domain([d3.min(data, xValue)-1, d3.max(data, xValue)+1]);
  yScale.domain([d3.min(data, yValue)-1, d3.max(data, yValue)+1]);

  // x-axis
  svg.append("g")
      .attr("class", "x axis2")
      .attr("transform", "translate(0," + height2 + ")")
      .call(xAxis)
    .append("text")
      .attr("class", "label")
      .attr("x", width2)
      .attr("y", -6)
      .style("text-anchor", "end")
      .text("MIN");

  // y-axis
  svg.append("g")
      .attr("class", "y axis2")
      .call(yAxis)
    .append("text")
      .attr("class", "label")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("PTS");

  // draw dots
  svg.selectAll(".dot2")
      .data(data)
    .enter().append("circle")
      .attr("class", "dot2")
      .attr("r", function(d){return 3.5+yValue(d)*10/xValue(d)})
      .attr("cx", xMap)
      .attr("cy", yMap)
      .style("fill", function(d) { return color(cValue(d));}) 
      .on("mouseover", function(d) {
          tooltip.transition()
               .duration(200)
               .style("opacity", .9);
          tooltip.html(d["PLAYER_NAME"] + "<br/> (" + xValue(d) 
          + ", " + yValue(d) + ")")
               .style("left", (d3.event.pageX + 5) + "px")
               .style("top", (d3.event.pageY - 28) + "px");
      })
      .on("mouseout", function(d) {
          tooltip.transition()
               .duration(500)
               .style("opacity", 0);
      });

  // draw legend
//  console.log(color)
  var legend = svg.selectAll(".legend")
      .data(color.domain())
    .enter().append("g")
      .attr("class", "legend")
      .attr("transform", function(d, i) { return "translate("+ -width2*0.75 +"," + i * 20 + ")"; });

  // draw legend colored rectangles
  legend.append("rect")
      .attr("x", width2 - 18)
      .attr("width", 18)
      .attr("height", 18)
      .style("fill", color);

  // draw legend text
  legend.append("text")
      .attr("x", width2 - 24)
      .attr("y", 9)
      .attr("dy", ".35em")
      .style("text-anchor", "end")
      .text(function(d) { return d;})
});

}
</script>
<div>
    <span id='calendar'></span>
</div>

<div>
    <span id='compare'></span>
</div>
<div>
    <span id='team1'></span>
    <span id='team2'></span>
    <span id='teambar'></span>
</div>    
<div>
    <span id='scatter'></span>
    <svg id='gaugetext' width="100%" height="50"></svg>
    <svg id='gauge1' width="16%" height="150"></svg>
    <svg id='gauge2' width="16%" height="150"></svg>
    <svg id='gauge3' width="16%" height="150"></svg>
    <svg id='gauge4' width="16%" height="150"></svg>
    <svg id='gauge5' width="16%" height="150"></svg>
    <svg id='gauge6' width="16%" height="150"></svg>
    <span id='moreinfo1' ></span>
    <span id='moreinfo2' ></span>   
</div>   

</body>

</html>
